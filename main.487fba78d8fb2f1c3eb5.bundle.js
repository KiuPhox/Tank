(()=>{"use strict";var e,t={245:(e,t,s)=>{s(260);class i extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(0),this.createLoadingGraphics(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(8971347,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingGraphics(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(16777215,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}const a=i;var h;!function(e){e.READY="ready",e.PLAYING="playing",e.PAUSE="pause"}(h||(h={}));const n=h;class r{static init(){this.emitter=new Phaser.Events.EventEmitter}static updateGameState(e,t){this.currentState!==e&&(this.previousState=this.currentState,this.currentState=e,this.emitter.emit("state-changed",this.currentState,this.previousState))}static getCurrentState(){return this.currentState}static getPreviousState(){return this.previousState}}r.currentState=n.READY,r.previousState=n.READY;const o=r;class c extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture),this.rotation=e.rotation,this.initImage(),this.scene.add.existing(this),e.screen.add(this)}initImage(){this.bulletSpeed=1e3,this.setOrigin(.5,.5),this.setDepth(2),this.scene.physics.world.enable(this),this.scene.physics.velocityFromRotation(this.rotation-Math.PI/2,this.bulletSpeed,this.body.velocity)}}class l extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.frame),this.screen=e.screen,this.scene.add.existing(this),this.initImage()}getBullets(){return this.bullets}initImage(){this.health=1,this.lastShoot=0,this.speed=100,this.setDepth(0),this.barrel=this.scene.add.image(0,0,"barrelBlue"),this.barrel.setOrigin(.5,1),this.barrel.setDepth(1),this.lifeBar=this.scene.add.graphics(),this.redrawLifebar(),this.bullets=this.scene.add.group({active:!0,maxSize:10,runChildUpdate:!0}),this.scene.physics.world.enable(this),this.screen.add([this,this.lifeBar,this.barrel])}redrawLifebar(){this.lifeBar.clear(),this.lifeBar.fillStyle(15100456,1),this.lifeBar.fillRect(-this.width/2,this.height/2,this.width*this.health,15),this.lifeBar.lineStyle(2,16777215),this.lifeBar.strokeRect(-this.width/2,this.height/2,this.width,15),this.lifeBar.setDepth(1)}update(e,t){this.barrel.x=this.x,this.barrel.y=this.y,this.lifeBar.x=this.x,this.lifeBar.y=this.y}updateHealth(){this.health>0?(this.health-=.05,this.redrawLifebar()):(this.destroy(),this.barrel.destroy(),this.lifeBar.destroy())}}const d=l;class p extends d{constructor(e){super(e)}initImage(){super.initImage(),this.barrel.setTexture("barrelRed"),this.scene.tweens.add({targets:this,props:{y:this.y-200},delay:0,duration:2e3,ease:"Linear",easeParams:null,hold:0,repeat:-1,repeatDelay:0,yoyo:!0})}update(e,t){super.update(e,t),this.active&&this.handleShooting()}handleShooting(){this.scene.time.now>this.lastShoot&&this.bullets.getLength()<10&&(this.bullets.add(new c({scene:this.scene,screen:this.screen,rotation:this.barrel.rotation,x:this.barrel.x,y:this.barrel.y,texture:"bulletRed"})),this.lastShoot=this.scene.time.now+400)}}class u extends d{getBullets(){return this.bullets}constructor(e){super(e)}initImage(){super.initImage(),this.scene.input.keyboard&&(this.cursors=this.scene.input.keyboard.createCursorKeys(),this.rotateKeyLeft=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.rotateKeyRight=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.shootingKey=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE))}update(e,t){super.update(e,t),this.active&&(this.handleInput(t),this.handleShooting())}handleInput(e){this.cursors.up.isDown?this.scene.physics.velocityFromRotation(this.rotation-Math.PI/2,this.speed,this.body.velocity):this.cursors.down.isDown?this.scene.physics.velocityFromRotation(this.rotation-Math.PI/2,-this.speed,this.body.velocity):this.body.setVelocity(0,0),this.cursors.left.isDown?this.rotation-=.002*e:this.cursors.right.isDown&&(this.rotation+=.002*e),this.rotateKeyLeft.isDown?this.barrel.rotation-=.005*e:this.rotateKeyRight.isDown&&(this.barrel.rotation+=.005*e)}handleShooting(){this.shootingKey.isDown&&this.scene.time.now>this.lastShoot&&(this.scene.cameras.main.shake(20,.005),this.scene.tweens.add({targets:this,props:{alpha:.8},delay:0,duration:5,ease:"Power1",easeParams:null,hold:0,repeat:0,repeatDelay:0,yoyo:!0,paused:!1}),this.bullets.getLength()<10&&(this.bullets.add(new c({scene:this.scene,screen:this.screen,rotation:this.barrel.rotation,x:this.barrel.x,y:this.barrel.y,texture:"bulletBlue"})),this.lastShoot=this.scene.time.now+80))}updateHealth(){super.updateHealth(),0===this.health&&(this.scene.scene.start(),o.updateGameState(n.READY,this.scene))}}class y extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture),this.initImage(),this.scene.add.existing(this)}initImage(){this.setOrigin(0,0),this.scene.physics.world.enable(this),this.body.setImmovable(!0)}}class m extends Phaser.GameObjects.Container{constructor(e){super(e.scene,e.x,e.y),e.scene.add.existing(this)}setActive(e){return this.setLogicUpdate(e).setVisible(e)}setLogicUpdate(e){return super.setActive(e),this.getAll().forEach((t=>{t.setActive(e)})),this}}const g=m,b=class extends g{constructor(e){super(e),this.bulletHitLayer=(e,t)=>{e.destroy()},this.bulletHitObstacles=(e,t)=>{e.destroy()},this.enemyBulletHitPlayer=(e,t)=>{const s=t;e.destroy(),s.updateHealth()},this.playerBulletHitEnemy=(e,t)=>{const s=t;e.destroy(),s.updateHealth()},this.onGameStateChanged=e=>{e===n.PLAYING?this.scene.cameras.main.startFollow(this.player):e===n.READY&&this.scene.cameras.main.stopFollow().setScroll(0,0)},this.createTileMap(),this.createObstaclesAndEnemies(),this.createColliders(),o.emitter.on("state-changed",this.onGameStateChanged)}createTileMap(){this.map=this.scene.make.tilemap({key:"levelMap"}),this.tileset=this.map.addTilesetImage("tiles"),this.tileset&&(this.layer=this.map.createLayer("tileLayer",this.tileset,0,0),this.layer&&(this.layer.setCollisionByProperty({collide:!0}),this.add(this.layer)))}createObstaclesAndEnemies(){this.obstacles=this.scene.add.group({runChildUpdate:!0}),this.enemies=this.scene.add.group({}),this.convertObjects()}createColliders(){this.layer&&(this.scene.physics.add.collider(this.player,this.layer),this.scene.physics.add.collider(this.player,this.obstacles),this.scene.physics.add.collider(this.player.getBullets(),this.layer,this.bulletHitLayer,void 0,this),this.scene.physics.add.collider(this.player.getBullets(),this.obstacles,this.bulletHitObstacles,void 0,this)),this.enemies.children.each((e=>{const t=e;return this.scene.physics.add.overlap(this.player.getBullets(),t,this.playerBulletHitEnemy,void 0,this),this.scene.physics.add.overlap(t.getBullets(),this.player,this.enemyBulletHitPlayer,void 0),this.scene.physics.add.collider(t.getBullets(),this.obstacles,this.bulletHitObstacles,void 0),this.layer&&this.scene.physics.add.collider(t.getBullets(),this.layer,this.bulletHitLayer,void 0),null}),this)}update(e,t){this.player.update(e,t),this.enemies.children.each((s=>{const i=s;if(i.update(e,t),this.player.active&&i.active){const e=Phaser.Math.Angle.Between(i.body.x,i.body.y,this.player.body.x,this.player.body.y);i.barrel.angle=(e+Math.PI/2)*Phaser.Math.RAD_TO_DEG}return null}),this)}convertObjects(){var e;(null===(e=this.map.getObjectLayer("objects"))||void 0===e?void 0:e.objects).forEach((e=>{if("player"===e.type)this.player=new u({scene:this.scene,screen:this,x:e.x,y:e.y,texture:"tankBlue"});else if("enemy"===e.type){const t=new p({scene:this.scene,screen:this,x:e.x,y:e.y,texture:"tankRed"});this.enemies.add(t)}else{const t=new y({scene:this.scene,screen:this,x:e.x,y:e.y-40,texture:e.type});this.add(t),this.obstacles.add(t)}}))}};class w extends Phaser.GameObjects.Container{constructor(e){var t;super(e.scene,e.x,e.y),this.onPointerDown=()=>{this.setScale(.9*this.defaultScale),this.isDown=!0,void 0!==this.pointerDownCallback&&this.pointerDownCallback()},this.onPointerUp=()=>{this.setScale(this.defaultScale),this.isDown&&(this.isDown=!1,void 0!==this.pointerUpCallback&&this.pointerUpCallback())},this.onPointerOver=()=>{this.scene.add.tween({targets:this,scale:1.1*this.defaultScale,duration:100})},this.onPointerOut=()=>{this.scene.add.tween({targets:this,scale:this.defaultScale,duration:100})},e.scene.add.existing(this),this.pointerDownCallback=e.pointerDownCallback,this.pointerUpCallback=e.pointerUpCallback,this.button=e.scene.add.nineslice(0,0,e.texture,e.frame,e.width,e.height,e.leftWidth,e.rightWidth,e.topHeight,e.bottomHeight),this.defaultScale=null!==(t=e.scale)&&void 0!==t?t:1,this.setScale(this.defaultScale),this.isDown=!1,this.button.setInteractive(),this.button.on("pointerdown",this.onPointerDown),this.button.on("pointerup",this.onPointerUp),this.button.on("pointerout",this.onPointerOut),this.button.on("pointerover",this.onPointerOver),this.text=this.scene.add.bitmapText(0,0,"font",e.text,e.size),Phaser.Display.Align.In.Center(this.text,this.button),this.add([this.button,this.text])}}const x=class extends g{constructor(e){super(e),this.pauseButton=new w({scene:e.scene,x:0,y:0,texture:"pauseIcon",scale:1,width:104,height:90,pointerUpCallback:()=>{o.updateGameState(n.PAUSE,this.scene)}}),Phaser.Display.Align.In.TopRight(this.pauseButton,this.scene.zone,-60,-60),this.add(this.pauseButton)}},S=class extends g{constructor(e){super(e),this.bitmapTexts=[],this.onGameStateChanged=e=>{e===n.READY?this.setActive(!0):this.setActive(!1)},e.scene.input.keyboard&&(this.startKey=e.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.startKey.isDown=!1),this.bitmapTexts.push(e.scene.add.bitmapText(0,0,"font","PRESS S TO PLAY",30)),this.bitmapTexts.push(e.scene.add.bitmapText(0,0,"font","TANK",100)),Phaser.Display.Align.In.Center(this.bitmapTexts[0],this.scene.zone,0,30),Phaser.Display.Align.In.Center(this.bitmapTexts[1],this.scene.zone,0,-30),this.add(this.bitmapTexts),o.emitter.on("state-changed",this.onGameStateChanged)}update(){this.active&&this.startKey.isDown&&o.updateGameState(n.PLAYING,this.scene)}},v=class extends g{constructor(e){super(e),this.createModal(),this.createContinueButton(),this.createNewGameButton(),this.add([this.modal,this.continueButton,this.newGameButton])}createModal(){this.modal=this.scene.add.nineslice(0,0,"purpleMsg",void 0,600,600,50,50,50,50)}createContinueButton(){this.continueButton=new w({scene:this.scene,x:0,y:-60,width:400,height:120,leftWidth:50,rightWidth:50,topHeight:50,bottomHeight:50,text:"Continue",size:50,texture:"blueBtn",scale:1,pointerUpCallback:()=>{o.updateGameState(n.PLAYING,this.scene)}})}createNewGameButton(){this.newGameButton=new w({scene:this.scene,x:0,y:60,width:400,height:120,leftWidth:50,rightWidth:50,topHeight:50,bottomHeight:50,text:"New Game",size:50,texture:"greenBtn",scale:1,pointerUpCallback:()=>{this.scene.scene.start("GameScene")}})}setActive(e){return e&&super.setActive(e),this.scene.add.tween({targets:this,scale:e?1:0,duration:300,ease:e?"Back.out":"Quad.out",onComplete:()=>{e||super.setActive(e)}}),this}};class f extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.onGameStateChanged=e=>{e===n.READY||(e===n.PLAYING?(this.gameScreen.setActive(!0),this.HUDScreen.setActive(!0),this.pauseScreen.setActive(!1)):e===n.PAUSE&&(this.gameScreen.setLogicUpdate(!1),this.HUDScreen.setActive(!1),this.pauseScreen.setActive(!0)))}}init(){o.init()}create(){this.createZone(),this.gameScreen=new b({scene:this}).setActive(!1),this.menuScreen=new S({scene:this}),this.HUDScreen=new x({scene:this}).setActive(!1),this.pauseScreen=new v({scene:this}).setVisible(!1),o.emitter.on("state-changed",this.onGameStateChanged)}createZone(){this.zone=this.add.zone(this.scale.width/2,this.scale.height/2,this.scale.width,this.scale.height)}update(e,t){this.gameScreen.update(e,t),this.menuScreen.update();const s=new Phaser.Math.Vector2(this.cameras.main.scrollX,this.cameras.main.scrollY);this.menuScreen.setPosition(s.x,s.y),this.HUDScreen.setPosition(s.x,s.y),this.pauseScreen.setPosition(s.x+this.scale.width/2,s.y+this.scale.height/2)}}const P=f,B={title:"Tank",url:"https://github.com/digitsensitive/phaser3-typescript",version:"2.0",scale:{width:window.innerWidth>window.innerHeight?1200*window.innerWidth/window.innerHeight:1600,height:1200,mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},zoom:.6,type:Phaser.AUTO,parent:"game",scene:[a,P],input:{keyboard:!0},physics:{default:"arcade",arcade:{gravity:{y:0}}},backgroundColor:"#000000",render:{pixelArt:!1,antialias:!0}};class A extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new A(B)}))}},s={};function i(e){var a=s[e];if(void 0!==a)return a.exports;var h=s[e]={exports:{}};return t[e].call(h.exports,h,h.exports,i),h.exports}i.m=t,e=[],i.O=(t,s,a,h)=>{if(!s){var n=1/0;for(l=0;l<e.length;l++){for(var[s,a,h]=e[l],r=!0,o=0;o<s.length;o++)(!1&h||n>=h)&&Object.keys(i.O).every((e=>i.O[e](s[o])))?s.splice(o--,1):(r=!1,h<n&&(n=h));if(r){e.splice(l--,1);var c=a();void 0!==c&&(t=c)}}return t}h=h||0;for(var l=e.length;l>0&&e[l-1][2]>h;l--)e[l]=e[l-1];e[l]=[s,a,h]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var a,h,[n,r,o]=s,c=0;if(n.some((t=>0!==e[t]))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(o)var l=o(i)}for(t&&t(s);c<n.length;c++)h=n[c],i.o(e,h)&&e[h]&&e[h][0](),e[h]=0;return i.O(l)},s=self.webpackChunktype_project_template=self.webpackChunktype_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=i.O(void 0,[216],(()=>i(245)));a=i.O(a)})();